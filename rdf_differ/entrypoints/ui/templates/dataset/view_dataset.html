{% extends "base.html" %}
{% from "macros.html" import render_select_field with context %}
{% set active_page = "view_dataset" %}

{% block app_content %}
    <h1>Details: {{ dataset.dataset_id }}</h1>
    <br>
    <div class="row">
        <table class="table striped">
            <tbody>
            <tr>
                <th>Description</th>
                <th>{{ dataset.dataset_description }}</th>
            </tr>
            <tr>
                <th>Dataset URI</th>
                <th>{{ dataset.dataset_uri }}</th>
            </tr>
            <tr>
                <th>Versions</th>
                <th>{{ dataset.dataset_versions|join(" & ") }}</th>
            </tr>
            <tr>
                <th>Diff date</th>
                <th>{{ dataset.diff_date }}</th>
            </tr>
            <tr>
                <th>Version named graphs</th>
                <th>{{ dataset.version_named_graphs|join(' & ') }}</th>
            </tr>
            <tr>
                <th>New version name</th>
                <th>{{ dataset.new_version_id }}</th>

            </tr>
            <tr>
                <th>Old version name</th>
                <th>{{ dataset.old_version_id }}</th>
            </tr>
            </tbody>
        </table>
    </div>
    <br>
    <div class="row">
        <form class="col s12 z-depth-3 form" method="POST" role="form" action="">
            {{ form.csrf_token }}

            {{ render_select_field(form.application_profile, 'application-profile') }}
            {{ render_select_field(form.template_type, 'template-type') }}
            <div class="row">
                <div class="col s12 right-align">
                    {{ form.submit(class_='btn btn-file blue darken-2') }}
                </div>
            </div>

        </form>
    </div>

    <script>
        let application_profile = document.getElementById('application-profile');
        let template_type = document.getElementById('template-type');

        application_profile.onchange = function () {
            value = application_profile.value;
            const application_profiles = {{ application_profiles|tojson }};
            const selected_application = application_profiles.find(
                ({application_profile}) => application_profile === value)

            let optionsHTML = '';
            for (let template_variation of selected_application['template_variations']) {
                optionsHTML += '<option value="' + template_variation + '">' + template_variation + '</option>';
            }
            template_type.innerHTML = optionsHTML;
        }
    </script>


{% endblock %}